<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Correlation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
      background: #fff;
    }
    h3 { color: #1976d2; margin-top: 0; }
    .group-title { font-weight: bold; margin-bottom: 10px; font-size: 16px; }
    .group-section { margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; padding: 15px; background: #f7f7f7;}
    .column-list { max-height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #fff;}
    .column-list label { display: block; margin-bottom: 8px; padding: 4px; cursor: pointer;}
    .column-list label:hover { background: #e3f2fd; }
    .method-section { margin-bottom: 20px; padding: 10px; background: #f0f0f0; border-radius: 4px;}
    .actions { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;}
    button { padding: 10px 20px; margin-right: 10px; cursor: pointer; border: 1px solid #ccc; background: #fff; border-radius: 4px;}
    button[type="submit"] { background: #1976d2; color: white; border-color: #1976d2;}
    button[type="submit"]:hover { background: #1565c0;}
    .error { color: #d32f2f; margin-top: 10px; padding: 8px; background: #ffebee; border-radius: 4px; display: none;}
    .info { background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 14px;}
    .popup-close { position: absolute; top: 12px; right: 16px; font-size: 20px; color: #555; cursor: pointer;}
    .popup-close:hover { color: #000;}
  </style>
</head>
<body>
  <div class="popup-close" onclick="closePopup()">✕</div>
  <h3>Pairwise Distances</h3>
  <form id="form">
    <div class="column-list" id="list1"></div>
    <div class="actions">
      <button type="submit">Calculate</button>
      <button type="button" onclick="closePopup()">Cancel</button>
    </div>
    <div class="error" id="errorMsg"></div>
  </form>
  <script>
    function closePopup(){ parent.closeModal(); }
    function loadCols(){
      const headers = JSON.parse(decodeURIComponent(new URLSearchParams(window.location.search).get('headers')));
      document.getElementById('list1').innerHTML = headers.map((h,i)=>
        `<label><input type="checkbox" value="${i}"> ${h}</label>`
      ).join('');
    }
    document.getElementById('form').onsubmit = e=>{
      e.preventDefault();
      const cols = Array.from(document.querySelectorAll('#list1 input:checked')).map(i=>+i.value);
      if(cols.length<1){
        return document.getElementById('errorMsg').textContent = 'Select ≥1 var';
      }
      parent.runCalculation('correlation', [], { method:'distances', group1:cols });
    };
    window.onload=loadCols;
  </script>
</body>
</html>